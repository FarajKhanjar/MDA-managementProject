<html style="background-color: whitesmoke;">
    <body onload="addShift()">
        <h1 style="text-align: center; color:crimson">New shift form</h1>
        <table id="menuTable" style="margin-left:auto;margin-right:auto;">
            <tr>
                <td>
                    <button onclick="returnPageButton()" id="mainPageButton">Return Main Page</button>
                </td>
            </tr>
        </table>

        <div>
            <h3 id="title" style="color: darkblue;"></h3>
        </div>

        <div id="AddToData">
            <h3>Please fill data in the form below:</h3>
            <form id="form" method="POST">
                <div>
                    <label>Department:</label>
                    <input type="text" id="department" required>
                </div><br/>
                <div>
                    <label>Shift Date:</label>
                    <input type="text" id="date" placeholder="(yyyy-mm-dd)" required>
                </div><br/>

                <div>
                    <label>Starting Hour:</label>
                    <input type="text" id="startingHour" placeholder="hh:mm" required>
                </div><br/>

                <div>
                    <label>Ending Hour:</label>
                    <input type="text" id="endingHour" placeholder="hh:mm" required>
                </div><br/>
         
                <div>
                    <input type="submit" value="Add to data"/>
                    <input type="reset" value="Reset"/>
                    <input id="returnButton" type="button" value="Return" onclick="returnPageButton()"/>
                </div>

            </form>
        </div>
    </body>
    
    <script>
        const url = 'http://localhost:8080/shifts';
        const depUrl = 'http://localhost:8080/departments';

        async function returnPageButton() {
            window.location.href = './welcome.html';
        }
         
        async function addShift() {

            const idValue = localStorage.getItem('sendDepIdToAddPage');
            console.log(idValue);

            const resp = await fetch(depUrl+"/"+idValue);
            const data = await resp.json();
            let depName = data[0].name;

            var idid = document.getElementById('department').value = depName;
            console.log(idid)

            var form = document.getElementById('form');

            form.addEventListener('submit', function(e) {
            e.preventDefault();
            

            var date=document.getElementById('date').value
            var startingHour=document.getElementById('startingHour').value
            var endingingHour=document.getElementById('endingHour').value
            var title=document.getElementById("title")
            let text= "";

            fetch(url+'/', {
                method: 'POST',
                body: JSON.stringify({
                    date:date,
                    startingHour:startingHour,
                    endingHour:endingingHour,
                    department:idValue
                }),
                
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                }
                

            }).then(function(response) { 
                return response.json()}).then(function(data)
                {
                    console.log(data)
                    text = "The Following shift is successfuly posted, to department: " + idValue;
                    console.log(text);
                    location.reload();
                })
                .catch(error => {
                    console.log('Wrong data.')
                    text = "Something wrong, check input again."
                    console.error(text + ' Error:', error)
                });
                title.innerHTML = text;  
            });
        } 

    </script>
</html>